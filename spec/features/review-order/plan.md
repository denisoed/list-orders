# Implementation Plan

**Plan:** Разработать новый поток отправки заказа на проверку: после нажатия «Отметить выполненным» пользователь попадает на отдельную страницу с формой загрузки фотографий и ввода комментария, данные отправляются на сервер и фиксируют статус «На проверке».

## Data sources / schemas
- Проверить текущую модель заказа и статусы; при необходимости добавить статус `submitted_for_review` или аналогичный в перечислениях и API-ответах.
- Уточнить контракт загрузки медиа: использовать существующее хранилище (S3/локальное) и предусмотреть лимит по количеству и размеру файлов, сохраняя ссылки в сущности заказа или отдельной таблице вложений.
- Гарантировать, что форма отправляет multipart-запрос: изображения + текст комментария + идентификатор заказа.
- Если на фронтенде хранится временное состояние заказа (Pinia/Vue Query), обновлять локальный стор после успешной отправки, чтобы отразить статус без полного рефреша.

## Contracts and interfaces
- Актуализировать фронтенд-роут `/orders/{id}/submit-review` (или аналогичный) и обеспечить получение исходных данных заказа через существующий API.
- Определить интерфейс запроса: `POST /api/orders/{id}/submit-review` с полями `comment: string`, `photos[]: File` и ожидаемым ответом со статусом.
- Обработать ошибки API: структура ответа с кодами (например, 400 — валидация, 413 — превышен размер, 500 — системная ошибка) и отображение сообщений на UI.
- Для повторной отправки предусмотреть перехват статусов, запрещающих повторное нажатие без обновления (например, если заказ уже на проверке).

## Architecture / Components
- Расширить компонент страницы деталей заказа: при клике на «Отметить выполненным» выполнить переход на новый маршрут через router push.
- Создать компонент формы отправки: поля для предпросмотра изображений, удаление выбранных файлов, текстовое поле комментария с валидацией, кнопки «Отправить» и «Назад».
- Интегрировать существующие UI-компоненты (кнопки, загрузчик файлов) согласно дизайн-системе, обрабатывать состояние загрузки и блокировку действий во время запроса.
- Реализовать сервис/композабл для отправки данных на сервер, повторно использовать клиент API и централизованную обработку ошибок/успеха (тосты, редиректы).
- После успешной отправки выполнить редирект: либо обратно на детали заказа с обновлённым статусом, либо на экран подтверждения.

## Risks
- Возможные ограничения бэкенда на количество/размер фотографий — нужно уточнить заранее, чтобы настроить валидацию.
- Долгая загрузка файлов на медленном соединении может привести к таймаутам; стоит предусмотреть прогресс и повтор.
- Несогласованность статусов на фронтенде и бэкенде может привести к тому, что заказ останется в неправильном состоянии.

## Assumptions
- API для загрузки изображений и смены статуса может быть расширено в рамках текущего спринта без зависимости от сторонних команд.
- Дизайн новой страницы соответствует текущим UI-паттернам; дополнительных макетов не требуется или они будут предоставлены отдельно.
- Уведомления участников (куратор, заказчик) настроены через существующую систему и не требуют правок в рамках этой задачи.
