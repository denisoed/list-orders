# Telegram InitData Validation

**Specification:** На стороне клиента нужно отправлять на сервер telegram initData. На стороне сервера нужно добавить логику валидации initData. Результат выводить в console.log. Используется npm пакет `@telegram-apps/init-data-node`.

## User Stories

- Как разработчик приложения, я хочу автоматически отправлять telegram initData на сервер при инициализации приложения, чтобы сервер мог проверить подлинность запроса от Telegram.
- Как администратор системы, я хочу видеть результаты валидации initData в логах сервера, чтобы контролировать безопасность и выявлять потенциальные проблемы аутентификации.
- Как пользователь Telegram Mini App, я хочу быть уверенным, что мое приложение защищено от несанкционированного доступа через валидацию данных инициализации Telegram.

## Main scenarios and rules

- При инициализации приложения на клиенте необходимо получить `initData` из объекта `window.Telegram.WebApp.initData` (или через Telegram WebApp SDK, если доступен).
- Клиент отправляет `initData` на серверный API endpoint через HTTP запрос (POST или GET) сразу после инициализации Telegram WebApp или при загрузке приложения.
- Серверный endpoint принимает `initData` в виде строки (raw search parameters format).
- На сервере используется функция `validate` из пакета `@telegram-apps/init-data-node` для проверки подписи и валидности данных.
- В качестве секретного токена для валидации используется Bot Token от Telegram Bot Father (или его хешированная версия).
- Результат валидации (успех или ошибка) выводится в `console.log` на сервере с понятным сообщением.
- При ошибке валидации функция `validate` выбрасывает исключение с типом ошибки (`ERR_AUTH_DATE_INVALID`, `ERR_HASH_INVALID`, `ERR_SIGN_INVALID`, `ERR_EXPIRED`), которую нужно обработать и залогировать.
- По умолчанию функция `validate` проверяет срок действия initData (expiration), который установлен на 1 день (86400 секунд). Это поведение сохраняется без изменений.
- Если initData отсутствует на клиенте (приложение запущено вне Telegram), клиент должен корректно обработать эту ситуацию и не отправлять запрос на сервер или отправить с соответствующим флагом.

## Non-functional requirements

- Серверная валидация должна выполняться синхронно и быстро (не более 50ms для стандартной валидации).
- Логирование результатов валидации должно быть информативным и не содержать чувствительных данных (например, не логировать полный Bot Token).
- Пакет `@telegram-apps/init-data-node` должен быть установлен только в зависимостях серверной части (devDependencies или dependencies, в зависимости от того, используется ли он в production).
- Код должен быть типизирован с использованием TypeScript, ошибки валидации должны быть корректно обработаны через try-catch блоки.
- API endpoint должен возвращать стандартный HTTP статус код (например, 200 при успехе, 400 при ошибке валидации).
- Решение должно следовать принципам KISS и не содержать избыточной логики или сложных абстракций.

## Assumptions

- Bot Token будет храниться в переменных окружения сервера (например, `TELEGRAM_BOT_TOKEN` для Nuxt).
- Приложение работает в контексте Nuxt 3, серверные роуты создаются в директории `server/api/`.
- Пакет `@telegram-apps/init-data-node` совместим с Node.js версией, используемой в проекте.
- Telegram WebApp SDK уже загружен и доступен в приложении через существующий composable `useTelegram`.
- InitData доступен только на клиенте, поэтому его получение должно происходить в клиентском коде.
- Если требуется отключить проверку expiration, это будет явно указано в отдельном запросе (по умолчанию проверка включена).

