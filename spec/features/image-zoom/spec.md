# Image Zoom

**Specification:** Добавить новую страницу для отображения выбранной картинки на всю ширину, с возможностью зумить и перемещать. На этой странице добавить шапку со стандартной кнопкой Назад. Добавить кнопки управления зумом и т.д.

## User Stories

1. **Как пользователь**, я хочу открыть изображение на полный экран из миниатюр в разделе "Примеры" на странице задачи, чтобы увидеть детали изображения в увеличенном размере.

2. **Как пользователь**, я хочу открыть изображение на полный экран из миниатюр в разделе "Фото примеров" на странице создания задачи, чтобы убедиться, что загрузил нужное фото и проверить его качество перед сохранением задачи.

3. **Как пользователь**, я хочу увеличивать и уменьшать масштаб изображения жестами (pinch-to-zoom) или кнопками управления, чтобы рассмотреть мелкие детали или увидеть изображение целиком.

4. **Как пользователь**, я хочу перемещать увеличенное изображение для просмотра разных его частей, чтобы изучить все области изображения при высоком масштабе.

5. **Как пользователь**, я хочу быстро вернуться на предыдущую страницу с помощью кнопки "Назад" в шапке, чтобы продолжить работу с основным контентом после просмотра изображения.

6. **Как пользователь**, я хочу видеть стандартную навигацию и элементы управления зумом, чтобы интуитивно понять, как работать с изображением без дополнительного обучения.

## Main scenarios and rules

### Основной сценарий просмотра изображения

**Сценарий 1: Просмотр с страницы деталей задачи**

1. Пользователь нажимает на миниатюру изображения в разделе "Примеры" на странице деталей задачи (`pages/orders/[id].vue`).
2. Приложение открывает новую страницу `/images/[imageId]?orderId=[id]&source=order-details` с полноэкранным просмотром изображения.
3. Изображение отображается по центру экрана с сохранением пропорций, адаптируясь под размер экрана.
4. Пользователь может взаимодействовать с изображением через жесты и кнопки управления.

**Сценарий 2: Просмотр со страницы создания задачи**

1. Пользователь нажимает на миниатюру изображения в разделе "Фото примеров" на странице создания задачи (`pages/projects/[id]/orders/new.vue`).
2. Приложение открывает новую страницу для просмотра изображения с полноэкранным режимом.
3. Изображение отображается по центру экрана с сохранением пропорций, адаптируясь под размер экрана.
4. Пользователь может увеличить изображение, чтобы проверить качество и убедиться, что загружено правильное фото.
5. После просмотра пользователь возвращается на страницу создания задачи для продолжения заполнения формы.

### Правила масштабирования

- Минимальный уровень масштаба: 100% (исходный размер изображения относительно экрана).
- Максимальный уровень масштаба: 500% (для детального просмотра).
- Шаг изменения масштаба через кнопки: 50% (100%, 150%, 200%, 250%, 300%, 350%, 400%, 450%, 500%).
- Масштаб можно изменять жестами pinch-to-zoom с плавной анимацией.
- При уменьшении масштаба до минимума изображение возвращается в исходное положение по центру экрана.

### Правила перемещения (pan)

- Перемещение изображения доступно только когда масштаб превышает 100%.
- При перемещении изображение ограничивается границами экрана (нельзя утащить изображение за пределы видимой области).
- После отпускания изображение плавно возвращается в допустимую позицию, если было перемещено слишком далеко.
- Поддержка инерционного движения (momentum scrolling) для плавного UX на мобильных устройствах.

### Элементы интерфейса

1. **Шапка страницы:**
   - Кнопка "Назад" (стандартная иконка arrow_back, как в других страницах проекта).
   - Полупрозрачный фон с blur-эффектом для видимости на фоне изображения.
   - Фиксированная позиция вверху экрана.

2. **Кнопки управления зумом:**
   - Кнопка "Увеличить" (zoom_in) — увеличивает масштаб на один шаг.
   - Кнопка "Уменьшить" (zoom_out) — уменьшает масштаб на один шаг.
   - Кнопка "Сбросить" (fit_screen или zoom_out_map) — возвращает изображение к исходному масштабу и центрирует его.
   - Расположение: фиксированная панель внизу экрана или в правом углу, полупрозрачный фон.
   - Кнопки активны только когда соответствующее действие доступно (например, "Увеличить" неактивна при максимальном масштабе).

3. **Индикатор масштаба (опционально):**
   - Текстовое или визуальное отображение текущего уровня масштаба (например, "200%").
   - Появляется временно при изменении масштаба, затем скрывается.

### Обработка ошибок

- Если изображение не загрузилось: отобразить сообщение об ошибке с кнопкой "Повторить" и возможностью вернуться назад.
- Если изображение повреждено или имеет недопустимый формат: показать сообщение об ошибке и кнопку "Назад".
- При медленной загрузке: показать индикатор загрузки (skeleton или spinner).

### Навигация

- При нажатии кнопки "Назад" происходит возврат на предыдущую страницу через `router.back()`.
- Поддержка нативной кнопки "Назад" в браузере (history API).
- При переходе на страницу через прямую ссылку, если нет предыдущей страницы в истории:
  - Если открыто со страницы деталей задачи — возврат на страницу деталей задачи (`/orders/[id]`).
  - Если открыто со страницы создания задачи — возврат на страницу создания задачи (`/projects/[id]/orders/new`).
  - В ином случае — возврат на страницу списка задач или главную страницу.

## Non-functional requirements

### Производительность

- Загрузка изображения должна начаться немедленно при открытии страницы.
- Использование lazy loading и оптимизация размера изображения для быстрой загрузки.
- Плавные анимации при масштабировании и перемещении (60 FPS).
- Оптимизация для работы на мобильных устройствах с ограниченной памятью.

### Адаптивность

- Страница должна корректно работать на всех размерах экранов (мобильные, планшеты, десктоп).
- Кнопки управления должны быть удобны для использования на сенсорных экранах (минимальный размер касания 44x44px).
- Поддержка жестов touch для мобильных устройств.

### Доступность

- Все кнопки должны иметь aria-label для читателей экрана.
- Клавиатурная навигация: поддержка Tab для переключения между кнопками, Enter/Space для активации.
- Соответствие WCAG 2.1 уровня AA для контрастности текста и элементов управления.

### Безопасность

- Валидация параметра `imageId` из URL для предотвращения XSS и других атак.
- Проверка прав доступа к изображению (если требуется в будущем).

### Совместимость

- Поддержка современных браузеров (Chrome, Firefox, Safari, Edge последних версий).
- Корректная работа в Telegram Web App (с учетом особенностей виртуальной клавиатуры).

### UX требования

- Плавные переходы и анимации для улучшения восприятия взаимодействия.
- Визуальная обратная связь при всех действиях пользователя (hover, active состояния).
- Интуитивно понятный интерфейс, не требующий инструкций.

## Assumptions

1. Изображения доступны по URL, которые передаются через параметры маршрута или query-параметры.
2. Страница просмотра изображения открывается с параметром `imageId` или `imageUrl` в URL.
3. Контекст предыдущей страницы сохраняется через роутер Vue/Nuxt, без необходимости передачи дополнительных параметров.
4. Все изображения имеют допустимый формат (jpg, png, webp) и загружаются с сервера или CDN.
5. Поддержка жестов touch для мобильных устройств реализуется через нативные события браузера или библиотеку обработки жестов.
6. Стандартная шапка должна соответствовать дизайну других страниц проекта (например, `pages/orders/[id].vue`).
7. Функциональность зума и панорамирования будет реализована через CSS transforms и JavaScript обработчики событий, без использования тяжелых библиотек, если возможно.
8. При необходимости можно использовать легковесные библиотеки для обработки жестов (например, hammer.js), если нативная реализация окажется слишком сложной.
9. Страница просмотра изображения должна быть доступна из двух источников: страницы деталей задачи (`pages/orders/[id].vue`) и страницы создания задачи (`pages/projects/[id]/orders/new.vue`).
10. Для страницы создания задачи изображения находятся в локальном состоянии формы (attachments), поэтому URL изображения может быть как локальным (blob URL), так и серверным.

