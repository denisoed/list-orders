# Orders

**Context:** Добавить новую страницу для отображения выбранной картинки на всю ширину, с возможностью зумить и перемещать. На этой странице добавить шапку со стандартной кнопкой Назад. Добавить кнопки управления зумом и т.д.

## Main directions

### Роутинг и навигация

- [ ] Создать универсальный динамический маршрут `/images/[imageId].vue` в структуре `pages/images/` для просмотра изображений из разных источников.
- [ ] Добавить обработчик клика на миниатюры изображений в `pages/orders/[id].vue` (секция "Примеры") для перехода на страницу просмотра с query-параметрами `orderId` и `source=order-details`.
- [ ] Добавить обработчик клика на миниатюры изображений в `pages/projects/[id]/orders/new.vue` (секция "Фото примеров") для перехода на страницу просмотра с query-параметрами `projectId` и `source=order-create`.
- [ ] Реализовать функцию возврата на предыдущую страницу через `router.back()` в компоненте просмотра, с fallback на построение URL из query-параметров при отсутствии истории.

### UI компоненты страницы просмотра

- [ ] Создать базовую структуру страницы `pages/images/[imageId].vue` с layout и стилизацией.
- [ ] Реализовать шапку страницы со стандартной кнопкой "Назад" (иконка `arrow_back`), соответствующую дизайну других страниц проекта.
- [ ] Добавить стилизацию шапки: полупрозрачный фон с blur-эффектом, фиксированная позиция вверху.
- [ ] Реализовать отображение изображения по центру экрана с сохранением пропорций и адаптацией под размер экрана.
- [ ] Добавить индикатор загрузки (skeleton или spinner) при загрузке изображения.
- [ ] Реализовать обработку ошибок загрузки изображения с отображением сообщения и кнопкой "Повторить".

### Функциональность масштабирования

- [ ] Реализовать состояние масштабирования: reactive ref для хранения текущего scale (от 1.0 до 5.0).
- [ ] Добавить обработку события `wheel` для масштабирования колесиком мыши на десктопе.
- [ ] Реализовать обработку жестов pinch-to-zoom для мобильных устройств (touchstart, touchmove, touchend).
- [ ] Добавить ограничение масштаба: минимум 1.0 (100%), максимум 5.0 (500%).
- [ ] Применить CSS `transform: scale()` для визуального масштабирования изображения.
- [ ] Добавить плавные анимации при изменении масштаба через CSS transitions.

### Функциональность перемещения (pan)

- [ ] Реализовать состояние позиции изображения: reactive refs для translateX и translateY.
- [ ] Добавить обработку drag-and-drop для перемещения изображения мышью (mousedown, mousemove, mouseup).
- [ ] Реализовать обработку touch-жестов для перемещения на мобильных устройствах.
- [ ] Добавить расчет и ограничение границ перемещения на основе текущего масштаба и размеров изображения.
- [ ] Реализовать автоматическое возвращение изображения в допустимую позицию при выходе за границы (с анимацией).
- [ ] Применить CSS `transform: translate()` для визуального перемещения изображения.
- [ ] Добавить поддержку инерционного движения (momentum scrolling) для плавного UX на мобильных.

### Кнопки управления зумом

- [ ] Создать панель с кнопками управления зумом (фиксированная позиция внизу или правом нижнем углу).
- [ ] Реализовать кнопку "Увеличить" (иконка `zoom_in`) с шагом 50% (0.5).
- [ ] Реализовать кнопку "Уменьшить" (иконка `zoom_out`) с шагом 50% (0.5).
- [ ] Реализовать кнопку "Сбросить" (иконка `fit_screen` или `zoom_out_map`) для возврата к масштабу 100% и центрирования.
- [ ] Добавить визуальную обратную связь для кнопок (hover, active состояния).
- [ ] Реализовать логику деактивации кнопок когда соответствующее действие недоступно (например, "Увеличить" неактивна при maxScale).
- [ ] Добавить полупрозрачный фон для панели управления зумом для лучшей видимости на фоне изображения.

### Индикатор масштаба (опционально)

- [ ] Добавить временное отображение текущего уровня масштаба (например, "200%") при изменении масштаба.
- [ ] Реализовать автоматическое скрытие индикатора через 2-3 секунды после последнего изменения.

### Интеграция с данными

- [ ] Реализовать получение данных изображения из route параметров (`imageId`) и query-параметров (`orderId`, `projectId`, `source`).
- [ ] Добавить логику получения URL изображения в зависимости от источника:
  - Если `source === 'order-details'` и указан `orderId` — получение из структуры данных задачи (mock данные из `data/orders.ts`).
  - Если `source === 'order-create'` — получение из локального состояния формы (attachments), URL может быть blob URL из File объекта.
- [ ] Реализовать валидацию параметров маршрута (проверка наличия imageId, валидность значения).
- [ ] Добавить обработку случая, когда изображение с указанным `imageId` не найдено (404 или сообщение об ошибке) с учетом источника.
- [ ] Обработать поддержку blob URL для локально загруженных изображений на странице создания задачи.

### Адаптивность и доступность

- [ ] Обеспечить корректное отображение на всех размерах экранов (мобильные, планшеты, десктоп).
- [ ] Убедиться, что кнопки имеют минимальный размер касания 44x44px для удобства на сенсорных экранах.
- [ ] Добавить aria-label для всех интерактивных элементов (кнопки, изображение).
- [ ] Реализовать клавиатурную навигацию: Tab для переключения между кнопками, Enter/Space для активации.
- [ ] Обеспечить соответствие контрастности элементов управления требованиям WCAG 2.1 AA.

### Стилизация и UX

- [ ] Применить стили Tailwind CSS в соответствии с существующими паттернами проекта.
- [ ] Использовать те же цветовые схемы и компоненты, что и в других страницах (например, `pages/orders/[id].vue`).
- [ ] Добавить плавные переходы и анимации для всех взаимодействий (60 FPS).
- [ ] Обеспечить визуальную обратную связь при всех действиях пользователя.
- [ ] Проверить работу в Telegram Web App (с учетом особенностей виртуальной клавиатуры).

## Supporting orders

- [ ] Документация: добавить комментарии в код для сложных логических блоков (обработка жестов, расчет границ перемещения).
- [ ] Наблюдаемость: добавить логирование ошибок загрузки изображений (в режиме разработки) для отладки.
- [ ] Code review и PR: подготовить изменения для ревью с описанием реализации функциональности зума и перемещения.

## Definition of Done

- [ ] Все задачи выполнены и протестированы.
- [ ] Страница просмотра изображения корректно открывается при клике на миниатюру в разделе "Примеры" на странице деталей задачи.
- [ ] Страница просмотра изображения корректно открывается при клике на миниатюру в разделе "Фото примеров" на странице создания задачи.
- [ ] Поддерживается просмотр как серверных изображений (из задач), так и локальных blob URL (из формы создания задачи).
- [ ] Масштабирование работает через жесты pinch-to-zoom и колесико мыши с ограничениями от 100% до 500%.
- [ ] Перемещение изображения работает при масштабе выше 100% с ограничением границ экрана.
- [ ] Кнопки управления зумом корректно работают и визуально отражают доступность действий.
- [ ] Кнопка "Назад" возвращает пользователя на предыдущую страницу.
- [ ] Обработка ошибок загрузки изображения реализована с понятными сообщениями.
- [ ] Страница корректно работает на мобильных устройствах, планшетах и десктопе.
- [ ] Клавиатурная навигация и aria-labels добавлены для доступности.
- [ ] Анимации и переходы плавные (60 FPS) без лагов.
- [ ] Стилизация соответствует дизайну остального приложения.
- [ ] `/spec/core/verify.md` выполнен после завершения всех задач для проверки списка задач.

